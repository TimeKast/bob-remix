# 5.0 üé® Design System

> **Input**: Proyecto auditado (post `4.0_Auditoria.md`)
> **Output**: `/docs/16_design_system.md` + tokens/temas
> **Siguiente**: `5.1_UX_UI.md`

---

## üß† Obligatorio: Consultar agentes (ANTES QUE NADA)

### üìå Archivos que DEBES consultar

- `/.agent/agents/README.md` (reglas generales)
- `/.agent/agents/design-system-lead.md` (responsable principal)
- `/.agent/agents/frontend-specialist.md` (implementaci√≥n t√©cnica)
- `/.agent/agents/tech-lead.md` (est√°ndares de calidad)

### ‚úÖ Requisito de salida

En tu primera respuesta, incluye:

- "Agentes consultados (archivos le√≠dos):"
- "Reglas clave aplicadas:" (5‚Äì10 bullets)

---

## üé≠ Roles Requeridos

Act√∫a como:

1. **Lead Product Designer + Design Systems** (tokens, paleta, consistencia visual)
2. **Frontend Architect** (Next.js + Tailwind + shadcn/ui + next-themes)

---

## ‚ö° MODO DE TRABAJO OBLIGATORIO

### PLAN MODE (Primero)

- **Solo lectura y an√°lisis**
- **NO generar cambios de c√≥digo**
- Outputs requeridos:
  - Findings (m√°x 20 bullets de problemas detectados)
  - UI Inventory (tabla de componentes/surfaces)
  - Branding Kit (tabla de tokens + hex + contraste)
  - Theme Spec (Dark + Light + Predefinidos)
  - Component Catalog (lista priorizada + mapa)
  - Backlog Patch Preview (issues propuestos)

### EXEC MODE (Despu√©s)

- **Solo despu√©s de PLAN MODE completo y aprobado**
- Genera:
  - Archivos de tokens/temas
  - `/docs/16_design_system.md`
  - Actualizaci√≥n a `GITHUB_BACKLOG.md`
- Si algo no se puede verificar ‚Üí nota "Assumption" + issue de follow-up

---

## üìã Tareas PLAN MODE

### Tarea 1: Auditor√≠a de UI (Lectura)

**Objetivo**: Mapear el estado actual de la UI.

1. Identificar pantallas/rutas principales
2. Listar componentes existentes (shadcn + custom)
3. Detectar estilos hardcodeados e inconsistentes
4. Identificar d√≥nde hay tokens vs valores literales

**Output**: UI Inventory

| Pantalla/Ruta | Componentes Usados  | Tokens Usados | Hardcodeados | Notas  |
| ------------- | ------------------- | ------------- | ------------ | ------ |
| /dashboard    | Card, Button, Table | bg-background | #1a1a2e      | Migrar |
| ...           | ...                 | ...           | ...          | ...    |

---

### Tarea 2: Branding Kit (Tokens)

**Fuentes de verdad** (en orden de prioridad):

1. C√≥digo fuente:
   - `globals.css` / `app/globals.css`
   - `tailwind.config.(js|ts)`
   - `theme.ts` / `tokens.ts` / `constants/colors.ts`
   - Componentes shadcn (cn, variants)
2. Screenshots internos (si existen)
3. App en producci√≥n (solo para validar)

**Output**: Tabla de Tokens

| Token      | Rol              | Valor Dark | Valor Light | Contraste | Uso            |
| ---------- | ---------------- | ---------- | ----------- | --------- | -------------- |
| background | Fondo principal  | #0a0a0a    | #ffffff     | N/A       | Body, layouts  |
| foreground | Texto principal  | #fafafa    | #0a0a0a     | 21:1 ‚úÖ   | Texto body     |
| primary    | Acci√≥n principal | #3b82f6    | #2563eb     | 4.5:1 ‚úÖ  | Botones, links |
| ...        | ...              | ...        | ...         | ...       | ...            |

**Tokens m√≠nimos requeridos**:

- background, foreground
- card, card-foreground
- popover, popover-foreground
- muted, muted-foreground
- border, input, ring
- primary, primary-foreground
- secondary, secondary-foreground
- accent, accent-foreground
- success, warning, danger, info (+ foregrounds)

**Lista de hardcodeados detectados**:

- Archivo: ubicaci√≥n del valor hardcodeado
- Plan de migraci√≥n: qu√© token debe usarse

---

### Tarea 3: Sistema de Theming Completo

#### 3.1 Base Theme Switching

| Modo   | Descripci√≥n                   | Comportamiento                         |
| ------ | ----------------------------- | -------------------------------------- |
| Dark   | Source of truth (look actual) | Tema por defecto si no hay preferencia |
| Light  | Propuesta coherente           | Mismos roles, valores claros           |
| System | Detectar preferencia del SO   | Usar `prefers-color-scheme`            |

**Estrategia t√©cnica**:

- CSS variables (shadcn style) en `:root` y `.dark`
- `next-themes` para toggling (ThemeProvider)
- Default: system, persistir en localStorage
- PWA: sincronizar `theme_color` meta tag

#### 3.2 Temas Predefinidos

Definir 3-5 paletas seleccionables:

| Tema       | Descripci√≥n              | Tokens que cambian     |
| ---------- | ------------------------ | ---------------------- |
| Default    | Paleta base del proyecto | Todos (base)           |
| Ocean      | Tonos azules/cyan        | primary, accent        |
| Forest     | Tonos verdes/earth       | primary, accent        |
| Sunset     | Tonos c√°lidos/naranja    | primary, accent        |
| Monochrome | Grises puros             | primary, accent, muted |

Cada tema = objeto/archivo de tokens que extiende la base.

#### 3.3 Tema Personalizable por Usuario

Permitir al usuario:

- Elegir color primario (color picker)
- Elegir color accent (color picker)
- Preview en tiempo real antes de guardar
- Generaci√≥n autom√°tica de variantes (foreground, hover, etc.)

**Reglas**:

- Validar contraste AA autom√°ticamente
- Si contraste bajo ‚Üí advertir al usuario
- Limitar a: primary + accent (no toda la paleta)

#### 3.4 Settings UI

Componente `ThemeSettings`:

- Toggle Light/Dark/System
- Selector de tema predefinido (grid visual con preview)
- (Opcional) Color pickers para personalizaci√≥n
- Preview instant√°neo de cambios
- Bot√≥n "Restablecer a default"

**Ubicaci√≥n sugerida**: `/settings` o modal accesible desde AppShell/Header

#### 3.5 Persistencia de Preferencias

| Contexto            | Estrategia                                    |
| ------------------- | --------------------------------------------- |
| Usuario an√≥nimo     | `localStorage` (theme_mode, theme_preset)     |
| Usuario autenticado | DB (user_preferences) + sync con localStorage |
| PWA                 | Sincronizar `theme_color` meta tag al cambiar |

**Schema sugerido para DB**:

```sql
user_preferences (
  user_id PRIMARY KEY,
  theme_mode: 'light' | 'dark' | 'system',
  theme_preset: 'default' | 'ocean' | 'forest' | 'sunset' | 'custom',
  custom_primary: '#hex' | null,
  custom_accent: '#hex' | null
)
```

---

### Tarea 4: Flavor System (Opcional)

Para apps con "temporadas" o contextos (ej: deportes, eventos):

- Base theme se mantiene (neutrals, typography, layout)
- Solo cambia: 1‚Äì2 accents + backgrounds decorativos
- Controlado por feature flag/config
- Tokens adicionales: `accentSport`, `accentSport2`

---

### Tarea 5: Component Catalog

#### Componentes Base (shadcn)

Button, Input, Card, Dialog, Dropdown, Tabs, Table, Badge, Tooltip, Toast, Select, Checkbox, Radio, Switch, etc.

#### Componentes App-Specific

| Componente   | Prop√≥sito         | Variantes               |
| ------------ | ----------------- | ----------------------- |
| AppShell     | Layout principal  | sidebar, topbar         |
| PageHeader   | T√≠tulo + acciones | with-back, with-actions |
| EmptyState   | Sin datos         | icon, action            |
| LoadingState | Cargando          | spinner, skeleton       |
| StatCard     | M√©trica           | trend-up, trend-down    |
| ...          | ...               | ...                     |

**Por cada componente documentar**:

- Props y variantes (size, intent, state)
- Estados (default, hover, focus, disabled, loading, error)
- Accesibilidad (focus visible, keyboard nav, aria)
- **Sin hardcode de colores**: todo via tokens

**Output**: Mapa pantalla ‚Üí componentes

| Pantalla  | Componentes Necesarios                    |
| --------- | ----------------------------------------- |
| Dashboard | AppShell, PageHeader, StatCard, Table     |
| Settings  | AppShell, PageHeader, ThemeSettings, Form |
| ...       | ...                                       |

---

### Tarea 6: Backlog Patch (Preview)

Proponer issues para Design System:

```markdown
[APP-XXX] DS ‚Äî Implementar tokens base y CSS variables
[APP-XXX] DS ‚Äî Configurar next-themes (Light/Dark/System)
[APP-XXX] DS ‚Äî Crear temas predefinidos (Ocean, Forest, Sunset)
[APP-XXX] DS ‚Äî Implementar ThemeSettings UI
[APP-XXX] DS ‚Äî Persistencia de preferencias de tema
[APP-XXX] DS ‚Äî Migrar colores hardcodeados a tokens
[APP-XXX] DS ‚Äî Documentar Component Catalog
```

---

## üìã Tareas EXEC MODE

Solo cuando PLAN MODE est√© completo y aprobado:

1. **Crear `/docs/16_design_system.md`**
   - Tokens documentados
   - Temas documentados
   - Component Catalog
   - Guidelines de uso

2. **Crear archivos base** (si aplica):
   - `lib/themes/tokens.ts`
   - `lib/themes/presets.ts`
   - Actualizar `globals.css` con CSS variables
   - Actualizar `tailwind.config.ts`

3. **Actualizar `GITHUB_BACKLOG.md`**
   - Agregar issues de DS
   - Actualizar dependencias

4. **Handoff**
   - Entregar a usuario para revisi√≥n
   - Siguiente: `5.1_UX_UI.md`

---

## üîí Reglas / Constraints

- ‚ùå NO colores hardcodeados en componentes (solo tokens)
- ‚ùå NO inventar colores: si no puede inferir ‚Üí marcar TBD + issue
- ‚úÖ shadcn/ui + Tailwind como base, extender solo cuando sea necesario
- ‚úÖ Accesibilidad: contraste AA m√≠nimo, focus states, keyboard nav
- ‚úÖ No cambiar IA/UX flows salvo necesario

---

## üì¶ Entregables Esperados

### PLAN MODE

- [ ] Findings (m√°x 20 bullets)
- [ ] UI Inventory (tabla)
- [ ] Branding Kit (tabla de tokens)
- [ ] Theme Spec completo
- [ ] Component Catalog
- [ ] Backlog Patch Preview

### EXEC MODE

- [ ] `/docs/16_design_system.md`
- [ ] Archivos de tokens/temas (si aplica)
- [ ] `GITHUB_BACKLOG.md` actualizado

---

## üîÅ Handoff

Cuando el Design System est√© completo:

1. **Entregar al usuario para revisi√≥n**
2. **Esperar confirmaci√≥n expl√≠cita**
3. Solo cuando confirme, ejecutar: `5.1_UX_UI.md`

> ‚ö†Ô∏è **NO avanzar autom√°ticamente**. El usuario debe aprobar antes de continuar.

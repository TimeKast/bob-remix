# 2.2 üîß Environment Setup (Pre-Development)

> **Input**: `GITHUB_BACKLOG.md` (salida de 2.1)
> **Output**: Ambiente de desarrollo listo
> **Siguiente**: `3.0_Ejecucion_Local.md` (o `3.1_Ejecucion_GitHub.md` si usas GitHub)
> **Cu√°ndo ejecutar**: Despu√©s de crear el backlog, ANTES de ejecutar el primer issue.

---

## üéØ Objetivo

Preparar el ambiente de desarrollo completo para que el primer issue pueda ejecutarse sin bloqueantes:

- Dependencias instaladas
- Variables de entorno configuradas
- Servicios externos conectados
- Build y dev server funcionando

---

## üë• Agente(s) sugeridos

- `/.agent/agents/devops-engineer.md` (configuraci√≥n de ambiente)
- `/.agent/agents/fullstack-engineer.md` (verificaci√≥n de stack)
- `/.agent/agents/tech-lead.md` (validaci√≥n de setup)

---

## üìã Tareas Obligatorias

### 1. Verificar Prerequisitos del Sistema

```bash
# Verificar versiones m√≠nimas
node --version    # >= 18.x requerido
npm --version     # >= 9.x recomendado (o pnpm/yarn)
git --version     # >= 2.x
```

**Checklist**:

- [ ] Node.js versi√≥n correcta
- [ ] Package manager disponible
- [ ] Git configurado

---

### 2. Instalar Dependencias

```bash
# Instalar todas las dependencias del proyecto
npm install
# o
pnpm install
```

**Verificar**:

- [ ] `node_modules` creado sin errores
- [ ] No hay vulnerabilidades cr√≠ticas (`npm audit`)
- [ ] Lockfile actualizado

---

### 3. Configurar Variables de Entorno

Crear archivo `.env.local` en la ra√≠z del proyecto:

```bash
# Copiar template si existe
cp .env.example .env.local
# o crear nuevo
touch .env.local
```

#### Variables Base (Stack Next.js + Drizzle + NextAuth)

```env
# =============================
# APP
# =============================
NEXT_PUBLIC_APP_URL=http://localhost:3000

# =============================
# DATABASE (Neon PostgreSQL)
# =============================
DATABASE_URL=postgresql://user:password@host/database?sslmode=require

# =============================
# AUTHENTICATION (NextAuth)
# =============================
NEXTAUTH_URL=http://localhost:3000
NEXTAUTH_SECRET=your-secret-key-generate-with-openssl

# =============================
# BLOB STORAGE (Vercel Blob - si aplica)
# =============================
BLOB_READ_WRITE_TOKEN=vercel_blob_xxxxx

# =============================
# EMAIL (si aplica)
# =============================
# RESEND_API_KEY=re_xxxxx
# EMAIL_FROM=noreply@tudominio.com
```

**Checklist**:

- [ ] `.env.local` creado
- [ ] DATABASE_URL configurado y v√°lido
- [ ] NEXTAUTH_SECRET generado (usar `openssl rand -base64 32`)
- [ ] Variables adicionales seg√∫n `/docs/18_environment.md`

---

### 4. Configurar Servicios Externos

#### 4.1 Neon (Base de Datos)

1. Ir a [neon.tech](https://neon.tech)
2. Crear proyecto (o usar existente)
3. Copiar connection string a `DATABASE_URL`
4. Ejecutar migraciones:
   ```bash
   npx drizzle-kit push
   # o
   npx drizzle-kit migrate
   ```

**Checklist**:

- [ ] Proyecto Neon creado
- [ ] Connection string en `.env.local`
- [ ] Migraciones ejecutadas sin errores

#### 4.2 Vercel (Deploy)

1. Ir a [vercel.com](https://vercel.com)
2. Importar repositorio de GitHub
3. Configurar variables de entorno en Vercel:
   - `DATABASE_URL`
   - `NEXTAUTH_SECRET`
   - `NEXTAUTH_URL` (usar URL de producci√≥n)
   - Otras seg√∫n el proyecto

**Checklist**:

- [ ] Proyecto Vercel creado
- [ ] Repo conectado
- [ ] Variables de entorno configuradas
- [ ] Deploy de prueba exitoso (o pendiente)

#### 4.3 NextAuth Providers (si aplica)

Para cada provider de autenticaci√≥n:

- **Google**: Crear OAuth credentials en Google Cloud Console
- **GitHub**: Crear OAuth App en GitHub Developer Settings
- **Otros**: Seg√∫n documentaci√≥n del provider

**Checklist**:

- [ ] Provider(s) configurado(s)
- [ ] Client ID y Secret en `.env.local`
- [ ] Callback URLs correctas

---

### 5. Verificar Build y Dev Server

```bash
# Verificar que el proyecto compila
npm run build

# Verificar que typecheck pasa
npm run typecheck  # si existe

# Iniciar dev server
npm run dev
```

**Checklist**:

- [ ] `npm run build` pasa sin errores
- [ ] `npm run dev` inicia correctamente
- [ ] App accesible en http://localhost:3000
- [ ] Conexi√≥n a DB funciona (si hay seed/migrations)

---

### 6. Seed de Datos (si aplica)

```bash
# Si existe script de seed
npm run seed
# o
npx tsx scripts/seed.ts
```

**Checklist**:

- [ ] Datos de prueba insertados (si aplica)
- [ ] Usuario admin creado (si aplica)

---

## üìÑ Documentaci√≥n del Setup

Actualizar o crear:

- `/docs/18_environment.md` con todas las variables documentadas
- `README.md` con instrucciones de setup r√°pido

---

## ‚úÖ Resumen de Verificaci√≥n Final

Antes de continuar con `3.0_Ejecucion_Local.md`:

| Verificaci√≥n                  | Status |
| ----------------------------- | ------ |
| Dependencias instaladas       | ‚¨ú     |
| `.env.local` configurado      | ‚¨ú     |
| Database conectada            | ‚¨ú     |
| Migraciones ejecutadas        | ‚¨ú     |
| `npm run build` pasa          | ‚¨ú     |
| `npm run dev` funciona        | ‚¨ú     |
| Vercel configurado (opcional) | ‚¨ú     |

---

## üîí Seguridad

- ‚ùå NUNCA commitear `.env.local` (debe estar en `.gitignore`)
- ‚ùå NUNCA hardcodear secrets en c√≥digo
- ‚úÖ Usar variables de entorno para TODO secret
- ‚úÖ Rotar secrets peri√≥dicamente
- ‚úÖ Usar diferentes valores para dev/staging/prod

---

## üîÅ Handoff

Cuando el ambiente est√© listo:

1. **Confirmar** que todos los checks pasaron
2. **Documentar** cualquier variable adicional en `/docs/18_environment.md`
3. **Continuar** con `3.0_Ejecucion_Local.md` (o `3.1_Ejecucion_GitHub.md`)

> ‚ö†Ô∏è **NO ejecutar issues si el ambiente no est√° listo**. Esto causar√° errores y p√©rdida de tiempo.
